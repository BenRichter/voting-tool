<%- include('partials/head.ejs'); %>
<a href="/">Back to Listing</a>
<article>
	<aside class="<% if (request.userVoted === 1) { %>voted-up<% } %><% if (request.userVoted === -1) { %>voted-down<% } %>">
		<p class="votes-count"><%= request.score %></p>
		<form method="post" action="/vote">
			<input type="hidden" name="request_id" value="<%= request.id %>">
			<input type="hidden" name="action" value="plus">
			<button class="vote-up" type="submit">
				<svg width="22" height="20" viewBox="0 0 22 20" xmlns="http://www.w3.org/2000/svg"><path d="M0 20h4V8H0v12zM22 9c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L13.17 0 6.59 6.59C6.22 6.95 6 7.45 6 8v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9.09l-.01-.01L22 9z" fill-rule="nonzero" /></svg>
			</button>
		</form>
		<form method="post" action="/vote">
			<input type="hidden" name="request_id" value="<%= request.id %>">
			<input type="hidden" name="action" value="minus">
			<button class="vote-down" type="submit">
				<svg width="22" height="20" viewBox="0 0 22 20" xmlns="http://www.w3.org/2000/svg"><path d="M14 0H5c-.83 0-1.54.5-1.84 1.22L.14 8.27C.05 8.5 0 8.74 0 9v1.91l.01.01L0 11c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L8.83 20l6.59-6.59c.36-.36.58-.86.58-1.41V2c0-1.1-.9-2-2-2zm4 0v12h4V0h-4z" fill-rule="nonzero" /></svg>
			</button>
		</form>
	</aside>
	<% if (editMode && request.editAllowed) { %>
	<form method="post" action="/r/<%= request.id %>">
		<label for="title">Title</label>
		<input type="text" id="title" name="title" value="<%= request.title %>">
		<button type="submit">Save</button>
	</form>
	<% } else { %>
		<h1><%= request.title %></h1>
		<% if (request.editAllowed) { %><a href="?edit=1">edit</a><% } %>
	<% } %>
	<footer>Created <time datetime="<%= request.date %>"><%= request.dateRelative %></time> by <a href="https://github.com/<%= request.username %>"><%= request.username %></a></footer>
	<section>
		<% request.comments.forEach(comment => { %>
		<article>
			<aside>
				<img src="https://github.com/<%= comment.username %>.png?size=60" alt="<%= comment.username %>">
			</aside>
			<main>
			<% if (editMode && comment.editAllowed) { %>
				<form method="post" action="/comment">
					<input type="hidden" name="comment_id" value="<%= comment.id %>">
					<input type="hidden" name="request_id" value="<%= request.id %>">
					<textarea name="content"><%= comment.content %></textarea>
					<button type="submit">Save</button>
				</form>
			<% } else { %>
				<%- comment.contentParsed %>
			<% } %>
			</main>
			<footer>
				<% if (comment.userVote) { %><%= comment.userVote %> &bull;<% } %>
				<time datetime="<%= comment.date %>"><%= comment.dateRelative %></time> &bull;
				<a href="https://github.com/<%= comment.username %>"><%= comment.username %></a>
				<% if (comment.edited) { %>&bull; edited<% } %>
				<% if (comment.editAllowed) { %> &bull; <a href="?edit=1">edit</a><% } %>
			</footer>
		</article>
		<% }) %>
		<form method="post" action="/comment">
			<input type="hidden" name="request_id" value="<%= request.id %>">
			<textarea name="content"></textarea>
			<button type="submit">Post</button>
		</form>
	</section>
</article>
